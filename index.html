<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1976d2">
    
    <!-- iOS support -->
    <link rel="apple-touch-icon" href="icons/icon-512.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>L·ªãch √Çm D∆∞∆°ng</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            animation: backgroundShift 10s ease-in-out infinite alternate;
        }

        @keyframes backgroundShift {
            0% { background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%); }
            100% { background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #4facfe 100%); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 50%, #43e97b 100%);
            color: white;
            padding: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .notification-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            padding: 25px;
            border-bottom: 1px solid #e9ecef;
        }

        .notification-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .notification-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
            position: relative;
            overflow: hidden;
        }

        .notification-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .notification-btn:hover::before {
            left: 100%;
        }

        .notification-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }

        .notification-btn.disabled {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            cursor: not-allowed;
        }

        .notification-status {
            padding: 15px 20px;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }

        .notification-status.enabled {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .notification-status.disabled {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .search-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .search-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 25px;
        }

        .search-box {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .search-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #4facfe, #00f2fe, #43e97b);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .search-box:hover::before {
            transform: scaleX(1);
        }

        .search-box:hover {
            border-color: #4facfe;
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .search-box h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .input-group input, .input-group select {
            flex: 1;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #4facfe;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .search-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .search-btn:hover::before {
            left: 100%;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        /* Enhanced Special Dates Section */
        .special-dates-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .special-dates-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .add-special-date {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .add-special-date:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .special-dates-list {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        .special-dates-list:hover {
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        /* Enhanced Event Types */
        .special-date-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 15px;
            border-left: 5px solid;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .special-date-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .special-date-item:hover::before {
            opacity: 1;
        }

        .special-date-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Birthday - Pink/Red */
        .special-date-item.birthday {
            border-left-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(238, 90, 36, 0.1) 100%);
        }
        .special-date-item.birthday::before {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.05) 0%, rgba(238, 90, 36, 0.05) 100%);
        }

        /* Memorial - Purple */
        .special-date-item.memorial {
            border-left-color: #9b59b6;
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.1) 0%, rgba(142, 68, 173, 0.1) 100%);
        }
        .special-date-item.memorial::before {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.05) 0%, rgba(142, 68, 173, 0.05) 100%);
        }

        /* Holiday - Blue */
        .special-date-item.holiday {
            border-left-color: #3498db;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1) 0%, rgba(41, 128, 185, 0.1) 100%);
        }
        .special-date-item.holiday::before {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.05) 0%, rgba(41, 128, 185, 0.05) 100%);
        }

        /* Anniversary - Gold */
        .special-date-item.anniversary {
            border-left-color: #f39c12;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1) 0%, rgba(230, 126, 34, 0.1) 100%);
        }
        .special-date-item.anniversary::before {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.05) 0%, rgba(230, 126, 34, 0.05) 100%);
        }

        /* Date - Pink */
        .special-date-item.date {
            border-left-color: #e91e63;
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1) 0%, rgba(194, 24, 91, 0.1) 100%);
        }
        .special-date-item.date::before {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.05) 0%, rgba(194, 24, 91, 0.05) 100%);
        }

        /* Work - Gray */
        .special-date-item.work {
            border-left-color: #607d8b;
            background: linear-gradient(135deg, rgba(96, 125, 139, 0.1) 0%, rgba(69, 90, 100, 0.1) 100%);
        }
        .special-date-item.work::before {
            background: linear-gradient(135deg, rgba(96, 125, 139, 0.05) 0%, rgba(69, 90, 100, 0.05) 100%);
        }

        /* Health - Green */
        .special-date-item.health {
            border-left-color: #4caf50;
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.1) 0%, rgba(56, 142, 60, 0.1) 100%);
        }
        .special-date-item.health::before {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.05) 0%, rgba(56, 142, 60, 0.05) 100%);
        }

        /* Travel - Teal */
        .special-date-item.travel {
            border-left-color: #009688;
            background: linear-gradient(135deg, rgba(0, 150, 136, 0.1) 0%, rgba(0, 121, 107, 0.1) 100%);
        }
        .special-date-item.travel::before {
            background: linear-gradient(135deg, rgba(0, 150, 136, 0.05) 0%, rgba(0, 121, 107, 0.05) 100%);
        }

        /* Study - Indigo */
        .special-date-item.study {
            border-left-color: #3f51b5;
            background: linear-gradient(135deg, rgba(63, 81, 181, 0.1) 0%, rgba(48, 63, 159, 0.1) 100%);
        }
        .special-date-item.study::before {
            background: linear-gradient(135deg, rgba(63, 81, 181, 0.05) 0%, rgba(48, 63, 159, 0.05) 100%);
        }

        /* Sports - Orange */
        .special-date-item.sports {
            border-left-color: #ff9800;
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(245, 124, 0, 0.1) 100%);
        }
        .special-date-item.sports::before {
            background: linear-gradient(135deg, rgba(255, 152, 0, 0.05) 0%, rgba(245, 124, 0, 0.05) 100%);
        }

        /* Family - Warm Pink */
        .special-date-item.family {
            border-left-color: #e91e63;
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.1) 0%, rgba(194, 24, 91, 0.1) 100%);
        }
        .special-date-item.family::before {
            background: linear-gradient(135deg, rgba(233, 30, 99, 0.05) 0%, rgba(194, 24, 91, 0.05) 100%);
        }

        /* Friends - Cyan */
        .special-date-item.friends {
            border-left-color: #00bcd4;
            background: linear-gradient(135deg, rgba(0, 188, 212, 0.1) 0%, rgba(0, 151, 167, 0.1) 100%);
        }
        .special-date-item.friends::before {
            background: linear-gradient(135deg, rgba(0, 188, 212, 0.05) 0%, rgba(0, 151, 167, 0.05) 100%);
        }

        /* Other - Default */
        .special-date-item.other {
            border-left-color: #795548;
            background: linear-gradient(135deg, rgba(121, 85, 72, 0.1) 0%, rgba(93, 64, 55, 0.1) 100%);
        }
        .special-date-item.other::before {
            background: linear-gradient(135deg, rgba(121, 85, 72, 0.05) 0%, rgba(93, 64, 55, 0.05) 100%);
        }

        .delete-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .delete-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .delete-btn:hover::before {
            left: 100%;
        }

        .delete-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .toggle-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 20px;
            width: 100%;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .toggle-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .toggle-btn:hover::before {
            left: 100%;
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.3);
        }

        .hidden {
            display: none;
        }

        .date-type-selector, .repeat-type-selector {
            margin-bottom: 20px;
        }

        .date-type-selector label, .repeat-type-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        .repeat-toggle {
            display: flex;
            background: #e9ecef;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .repeat-toggle button {
            flex: 1;
            padding: 12px 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
        }

        .repeat-toggle button.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
        }

        .repeat-toggle button:hover:not(.active) {
            background: rgba(79, 172, 254, 0.1);
        }

        /* Enhanced Navigation */
        .navigation {
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
            padding: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(79, 172, 254, 0.3);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        /* Enhanced Calendar */
        .calendar-container {
            padding: 30px;
            background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-weight: 600;
            font-size: 16px;
        }

        td {
            border: 1px solid #e9ecef;
            padding: 15px;
            text-align: center;
            vertical-align: top;
            height: 100px;
            position: relative;
            background: white;
            transition: all 0.3s ease;
        }

        td:hover {
            background: #f8f9fa;
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .lunar-date {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 8px;
            font-style: italic;
        }

        .today {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            font-weight: bold;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4); }
            50% { box-shadow: 0 8px 30px rgba(255, 107, 107, 0.6); }
            100% { box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4); }
        }

        .today .lunar-date {
            color: rgba(255,255,255,0.8);
        }

        /* Calendar event styles */
        .birthday {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            font-weight: bold;
        }

        .memorial {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            font-weight: bold;
        }

        .holiday {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            font-weight: bold;
        }

        .anniversary {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            font-weight: bold;
        }

        .date {
            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
            color: white;
            font-weight: bold;
        }

        .work {
            background: linear-gradient(135deg, #607d8b 0%, #455a64 100%);
            color: white;
            font-weight: bold;
        }

        .health {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            font-weight: bold;
        }

        .travel {
            background: linear-gradient(135deg, #009688 0%, #00796b 100%);
            color: white;
            font-weight: bold;
        }

        .study {
            background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%);
            color: white;
            font-weight: bold;
        }

        .sports {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
            color: white;
            font-weight: bold;
        }

        .family {
            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
            color: white;
            font-weight: bold;
        }

        .friends {
            background: linear-gradient(135deg, #00bcd4 0%, #0097a7 100%);
            color: white;
            font-weight: bold;
        }

        .other {
            background: linear-gradient(135deg, #795548 0%, #5d4037 100%);
            color: white;
            font-weight: bold;
        }

        .highlighlunar {
            background: linear-gradient(135deg, #ff9ff3 0%, #feca57 100%);
            color: white;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 6px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(255, 159, 243, 0.5); }
            to { box-shadow: 0 0 15px rgba(254, 202, 87, 0.8); }
        }

        .special-event-indicator {
            position: absolute;
            top: 3px;
            right: 3px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e74c3c;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .event-note {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.9);
            margin-top: 3px;
            font-weight: normal;
            line-height: 1.2;
        }

        /* Enhanced Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 25px 0;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 20px;
            background: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .legend-color {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* Enhanced Search Results */
        .search-results {
            background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
            border: 2px solid #28a745;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: none;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
        }

        .search-results.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-item {
            background: white;
            padding: 15px;
            margin: 8px 0;
            border-radius: 12px;
            border-left: 4px solid #28a745;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .special-dates-container {
                grid-template-columns: 1fr;
            }
            
            .calendar-container {
                padding: 20px;
            }

            .header h1 {
                font-size: 2.5rem;
            }
            
            .navigation {
                gap: 10px;
                padding: 20px;
            }
            
            .nav-btn {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .search-container {
                grid-template-columns: 1fr;
            }
            
            table {
                font-size: 0.9rem;
            }
            
            td {
                height: 80px;
                padding: 10px;
            }

            th {
                padding: 15px;
            }

            .legend {
                gap: 15px;
            }

            .legend-item {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Month view for year calendar */
        .month-cell {
            display: inline-block;
            margin: 15px;
            vertical-align: top;
        }

        .month-cell table {
            font-size: 0.8rem;
            margin: 8px;
        }

        .month-cell td {
            height: 45px;
            padding: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô L·ªãch √Çm D∆∞∆°ngüåû</h1>
            <p>T√¨m ki·∫øm v√† theo d√µi ng√†y √¢m l·ªãch, d∆∞∆°ng l·ªãch v·ªõi nhi·ªÅu lo·∫°i s·ª± ki·ªán</p>
        </div>

        <!-- Ph·∫ßn c√†i ƒë·∫∑t th√¥ng b√°o -->
        <div class="notification-section">
            <div class="notification-toggle">
                <button id="notificationBtn" class="notification-btn" onclick="toggleNotifications()">
                    üîî B·∫≠t Th√¥ng B√°o
                </button>
            </div>
            <div id="notificationStatus" class="notification-status disabled">
                Th√¥ng b√°o ch∆∞a ƒë∆∞·ª£c b·∫≠t. Nh·∫•n n√∫t tr√™n ƒë·ªÉ nh·∫≠n th√¥ng b√°o v·ªÅ c√°c ng√†y ƒë·∫∑c bi·ªát.
            </div>
        </div>

        <div class="search-section">
            <div class="search-container">
                <div class="search-box">
                    <h3>üîç T√¨m Ng√†y D∆∞∆°ng L·ªãch</h3>
                    <div class="input-group">
                        <input type="number" id="solarDay" placeholder="Ng√†y" min="1" max="31">
                        <input type="number" id="solarMonth" placeholder="Th√°ng" min="1" max="12">
                        <input type="number" id="solarYear" placeholder="NƒÉm" min="1900" max="2100">
                    </div>
                    <button class="search-btn" onclick="searchSolarDate()">T√¨m Ng√†y D∆∞∆°ng</button>
                </div>

                <div class="search-box">
                    <h3>üåô T√¨m Ng√†y √Çm L·ªãch</h3>
                    <div class="input-group">
                        <input type="number" id="lunarDay" placeholder="Ng√†y" min="1" max="30">
                        <input type="number" id="lunarMonth" placeholder="Th√°ng" min="1" max="12">
                        <input type="number" id="lunarYear" placeholder="NƒÉm" min="1900" max="2100">
                    </div>
                    <button class="search-btn" onclick="searchLunarDate()">T√¨m Ng√†y √Çm</button>
                </div>
            </div>

            <div id="searchResults" class="search-results">
                <h4>K·∫øt qu·∫£ t√¨m ki·∫øm:</h4>
                <div id="resultContent"></div>
            </div>
        </div>

        <!-- Ph·∫ßn qu·∫£n l√Ω ng√†y ƒë·∫∑c bi·ªát -->
        <div class="special-dates-section">
            <button class="toggle-btn" onclick="toggleSpecialDatesSection()">
                üìù Qu·∫£n L√Ω Ng√†y ƒê·∫∑c Bi·ªát
            </button>
            
            <div id="specialDatesContainer" class="special-dates-container hidden">
                <div class="add-special-date">
                    <h3>‚ûï Th√™m Ng√†y ƒê·∫∑c Bi·ªát</h3>
                    
                    <div class="date-type-selector">
                        <label>Lo·∫°i ng√†y:</label>
                        <select id="eventType" onchange="toggleDateInputType()">
                            <option value="birthday">üéÇ Sinh nh·∫≠t</option>
                            <option value="memorial">üïØÔ∏è Ng√†y gi·ªó</option>
                            <option value="holiday">üéâ Ng√†y l·ªÖ</option>
                            <option value="anniversary">üíç K·ª∑ ni·ªám</option>
                            <option value="date">üíï H·∫πn h√≤</option>
                            <option value="work">üíº C√¥ng vi·ªác</option>
                            <option value="health">üè• S·ª©c kh·ªèe</option>
                            <option value="travel">‚úàÔ∏è Du l·ªãch</option>
                            <option value="study">üìö H·ªçc t·∫≠p</option>
                            <option value="sports">‚öΩ Th·ªÉ thao</option>
                            <option value="family">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Gia ƒë√¨nh</option>
                            <option value="friends">üë• B·∫°n b√®</option>
                            <option value="other">üìÖ Kh√°c</option>
                        </select>
                    </div>

                    <div class="repeat-type-selector">
                        <label>Lo·∫°i s·ª± ki·ªán:</label>
                        <div class="repeat-toggle">
                            <button type="button" id="oneTimeBtn" class="active" onclick="toggleRepeatType('oneTime')">
                                üìÖ M·ªôt l·∫ßn
                            </button>
                            <button type="button" id="yearlyBtn" onclick="toggleRepeatType('yearly')">
                                üîÑ H√†ng nƒÉm
                            </button>
                        </div>
                    </div>

                    <div id="dateInputs">
                        <div class="input-group">
                            <input type="number" id="specialDay" placeholder="Ng√†y" min="1" max="31">
                            <input type="number" id="specialMonth" placeholder="Th√°ng" min="1" max="12">
                            <input type="number" id="specialYear" placeholder="NƒÉm" min="1900" max="2100">
                        </div>
                        <div id="calendarTypeNote" style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">
                            Nh·∫≠p theo d∆∞∆°ng l·ªãch - Di·ªÖn ra m·ªôt l·∫ßn v√†o nƒÉm c·ª• th·ªÉ
                        </div>
                    </div>

                    <input type="text" id="specialNote" placeholder="T√™n ng∆∞·ªùi/Ghi ch√∫" style="width: 100%; margin-bottom: 20px; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 15px;">
                    <button class="search-btn" onclick="addSpecialDate()">Th√™m Ng√†y</button>
                </div>

                <div class="special-dates-list">
                    <h3>üìã Danh S√°ch Ng√†y ƒê·∫∑c Bi·ªát</h3>
                    <div id="specialDatesList"></div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button class="nav-btn" onclick="now()">üìÖ Hi·ªán T·∫°i</button>
            <button class="nav-btn" onclick="prevYear()">‚è™ NƒÉm Tr∆∞·ªõc</button>
            <button class="nav-btn" onclick="nextYear()">‚è© NƒÉm Sau</button>
            <button class="nav-btn" onclick="prevMonth()">‚¨ÖÔ∏è Th√°ng Tr∆∞·ªõc</button>
            <button class="nav-btn" onclick="nextMonth()">‚û°Ô∏è Th√°ng Sau</button>
            <button class="nav-btn" onclick="displayYearCalendar()">üìÜ C·∫£ NƒÉm</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color today"></div>
                <span>H√¥m nay</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);"></div>
                <span>üéÇ Sinh nh·∫≠t</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);"></div>
                <span>üïØÔ∏è Ng√†y gi·ªó</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);"></div>
                <span>üéâ Ng√†y l·ªÖ</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);"></div>
                <span>üíç K·ª∑ ni·ªám</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);"></div>
                <span>üíï H·∫πn h√≤</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #607d8b 0%, #455a64 100%);"></div>
                <span>üíº C√¥ng vi·ªác</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);"></div>
                <span>üè• S·ª©c kh·ªèe</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: linear-gradient(135deg, #009688 0%, #00796b 100%);"></div>
                <span>‚úàÔ∏è Du l·ªãch</span>
            </div>
            <div class="legend-item">
                <div class="legend-color highlighlunar"></div>
                <span>üåô M√πng 1 & R·∫±m</span>
            </div>
        </div>

        <div id="calendar" class="calendar-container"></div>
    </div>

    <script>
        // Service Worker registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/calendar/service-worker.js')
                .then(function (registration) {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(function (error) {
                    console.log('Service Worker registration failed:', error);
                });

            navigator.serviceWorker.register('/calendar/sw.js')
                .then(function(registration) {
                    console.log('SW registered:', registration);
                  }).catch(function(error) {
                    console.error('SW registration failed:', error);
                  });
        }
    </script>

    <script>
        // Bi·∫øn to√†n c·ª•c
        let monthOffset = 0;
        let yearoffset = 0;
        let currentMonth = 0;
        let currentYear = 0;
        let notificationPermission = false;
        let dailyCheckInterval = null;
        let currentRepeatType = 'oneTime'; // 'oneTime' ho·∫∑c 'yearly'
        
        // Danh s√°ch c√°c ng√†y ƒë·∫∑c bi·ªát v·ªõi nhi·ªÅu lo·∫°i h∆°n
        let specialEvents = {
            // S·ª± ki·ªán m·ªôt l·∫ßn (c√≥ nƒÉm c·ª• th·ªÉ)
            oneTime: {
                birthdays: [],
                memorials: [],
                holidays: [],
                anniversaries: [],
                dates: [],
                works: [],
                healths: [],
                travels: [],
                studies: [],
                sports: [],
                families: [],
                friends: [],
                others: []
            },
            // S·ª± ki·ªán h√†ng nƒÉm (kh√¥ng c√≥ nƒÉm)
            yearly: {
                birthdays: [],
                memorials: [],
                holidays: [],
                anniversaries: [],
                dates: [],
                works: [],
                healths: [],
                travels: [],
                studies: [],
                sports: [],
                families: [],
                friends: [],
                others: []
            }
        };

        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener("DOMContentLoaded", function() {
            loadSpecialDates();
            checkNotificationPermission();
            createCalendar();
            startDailyCheck();
        });

        // Toggle lo·∫°i l·∫∑p l·∫°i
        function toggleRepeatType(type) {
            currentRepeatType = type;
            
            // C·∫≠p nh·∫≠t UI buttons
            document.getElementById('oneTimeBtn').classList.remove('active');
            document.getElementById('yearlyBtn').classList.remove('active');
            document.getElementById(type + 'Btn').classList.add('active');
            
            // C·∫≠p nh·∫≠t input nƒÉm v√† ghi ch√∫
            const yearInput = document.getElementById('specialYear');
            const note = document.getElementById('calendarTypeNote');
            const eventType = document.getElementById('eventType').value;
            
            if (type === 'oneTime') {
                yearInput.style.display = 'block';
                yearInput.required = true;
                if (eventType === 'memorial') {
                    note.textContent = 'Nh·∫≠p theo √¢m l·ªãch - Di·ªÖn ra m·ªôt l·∫ßn v√†o nƒÉm c·ª• th·ªÉ';
                    note.style.color = '#9b59b6';
                } else {
                    note.textContent = 'Nh·∫≠p theo d∆∞∆°ng l·ªãch - Di·ªÖn ra m·ªôt l·∫ßn v√†o nƒÉm c·ª• th·ªÉ';
                    note.style.color = '#666';
                }
            } else {
                yearInput.style.display = 'none';
                yearInput.required = false;
                yearInput.value = '';
                if (eventType === 'memorial') {
                    note.textContent = 'Nh·∫≠p theo √¢m l·ªãch - L·∫∑p l·∫°i h√†ng nƒÉm';
                    note.style.color = '#9b59b6';
                } else {
                    note.textContent = 'Nh·∫≠p theo d∆∞∆°ng l·ªãch - L·∫∑p l·∫°i h√†ng nƒÉm';
                    note.style.color = '#666';
                }
            }
        }

        // Thay ƒë·ªïi lo·∫°i input d·ª±a tr√™n lo·∫°i s·ª± ki·ªán
        function toggleDateInputType() {
            const eventType = document.getElementById('eventType').value;
            const note = document.getElementById('calendarTypeNote');
            
            if (eventType === 'memorial') {
                if (currentRepeatType === 'oneTime') {
                    note.textContent = 'Nh·∫≠p theo √¢m l·ªãch - Di·ªÖn ra m·ªôt l·∫ßn v√†o nƒÉm c·ª• th·ªÉ';
                } else {
                    note.textContent = 'Nh·∫≠p theo √¢m l·ªãch - L·∫∑p l·∫°i h√†ng nƒÉm';
                }
                note.style.color = '#9b59b6';
            } else {
                if (currentRepeatType === 'oneTime') {
                    note.textContent = 'Nh·∫≠p theo d∆∞∆°ng l·ªãch - Di·ªÖn ra m·ªôt l·∫ßn v√†o nƒÉm c·ª• th·ªÉ';
                } else {
                    note.textContent = 'Nh·∫≠p theo d∆∞∆°ng l·ªãch - L·∫∑p l·∫°i h√†ng nƒÉm';
                }
                note.style.color = '#666';
            }
        }

        // Ki·ªÉm tra quy·ªÅn notification
        function checkNotificationPermission() {
            if ('Notification' in window) {
                const permission = Notification.permission;
                updateNotificationUI(permission);
                
                if (permission === 'granted') {
                    notificationPermission = true;
                }
            } else {
                document.getElementById('notificationBtn').classList.add('disabled');
                document.getElementById('notificationBtn').textContent = '‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£';
            }
        }

        // C·∫≠p nh·∫≠t giao di·ªán notification
        function updateNotificationUI(permission) {
            const btn = document.getElementById('notificationBtn');
            const status = document.getElementById('notificationStatus');
            
            switch(permission) {
                case 'granted':
                    btn.textContent = 'üîî Th√¥ng B√°o ƒê√£ B·∫≠t';
                    btn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                    status.className = 'notification-status enabled';
                    status.textContent = '‚úÖ Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c b·∫≠t. B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o v·ªÅ c√°c ng√†y ƒë·∫∑c bi·ªát.';
                    notificationPermission = true;
                    break;
                case 'denied':
                    btn.textContent = '‚ùå Th√¥ng B√°o B·ªã T·ª´ Ch·ªëi';
                    btn.classList.add('disabled');
                    status.className = 'notification-status disabled';
                    status.textContent = '‚ùå Th√¥ng b√°o ƒë√£ b·ªã t·ª´ ch·ªëi. Vui l√≤ng b·∫≠t l·∫°i trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.';
                    break;
                default:
                    btn.textContent = 'üîî B·∫≠t Th√¥ng B√°o';
                    status.className = 'notification-status disabled';
                    status.textContent = 'Th√¥ng b√°o ch∆∞a ƒë∆∞·ª£c b·∫≠t. Nh·∫•n n√∫t tr√™n ƒë·ªÉ nh·∫≠n th√¥ng b√°o v·ªÅ c√°c ng√†y ƒë·∫∑c bi·ªát.';
            }
        }

        // Toggle notifications
        function toggleNotifications() {
            if (!('Notification' in window)) {
                alert('Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th√¥ng b√°o!');
                return;
            }

            if (Notification.permission === 'granted') {
                showTestNotification();
            } else if (Notification.permission === 'denied') {
                alert('Th√¥ng b√°o ƒë√£ b·ªã t·ª´ ch·ªëi. Vui l√≤ng b·∫≠t l·∫°i trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.');
            } else {
                Notification.requestPermission().then(function(permission) {
                    updateNotificationUI(permission);
                    if (permission === 'granted') {
                        showTestNotification();
                    }
                });
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o test
        function showTestNotification() {
            alert('test th√¥ng b√°o');
            const notification = new Notification('üåô L·ªãch √Çm D∆∞∆°ng N√¢ng Cao', {
                body: 'Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c b·∫≠t th√†nh c√¥ng! B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o v·ªÅ c√°c ng√†y ƒë·∫∑c bi·ªát.',
                icon: '/calendar/icons/icon-512.png',
                badge: '/calendar/icons/icon-512.png',
                tag: 'test-notification'
            });

            navigator.serviceWorker.getRegistration().then(function(reg) {
              if (reg) {
                reg.showNotification('üåô L·ªãch √Çm D∆∞∆°ng', {
                  body: 'Th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c b·∫≠t th√†nh c√¥ng! B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c th√¥ng b√°o v·ªÅ c√°c ng√†y ƒë·∫∑c bi·ªát.',
                  icon: '/calendar/icons/icon-512.png',
                  badge: '/calendar/icons/icon-512.png'
                });
              }
              alert(`req: ${req}`);
            });

            notification.onclick = function() {
                window.focus();
                notification.close();
            };

            setTimeout(() => {
                notification.close();
            }, 5000);
        }

        // B·∫Øt ƒë·∫ßu ki·ªÉm tra h√†ng ng√†y
        function startDailyCheck() {
            checkTodayEvents();
            dailyCheckInterval = setInterval(checkTodayEvents, 60 * 60 * 1000);
            
            const now = new Date();
            const tomorrow8AM = new Date(now);
            tomorrow8AM.setDate(tomorrow8AM.getDate() + 1);
            tomorrow8AM.setHours(8, 0, 0, 0);
            
            const timeUntil8AM = tomorrow8AM.getTime() - now.getTime();
            
            setTimeout(() => {
                checkTodayEvents();
                setInterval(checkTodayEvents, 24 * 60 * 60 * 1000);
            }, timeUntil8AM);
        }

        // Ki·ªÉm tra s·ª± ki·ªán h√¥m nay
        function checkTodayEvents() {
            if (!notificationPermission) return;
            
            const today = new Date();
            const todayEvents = getSpecialEventsForDate(today.getDate(), today.getMonth(), today.getFullYear());
            
            if (todayEvents.length > 0) {
                const lastNotificationDate = localStorage.getItem('lastNotificationDate');
                const todayString = today.toDateString();
                
                if (lastNotificationDate !== todayString) {
                    showTodayEventsNotification(todayEvents);
                    localStorage.setItem('lastNotificationDate', todayString);
                }
            }
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowEvents = getSpecialEventsForDate(tomorrow.getDate(), tomorrow.getMonth(), tomorrow.getFullYear());
            
            if (tomorrowEvents.length > 0) {
                const lastTomorrowNotificationDate = localStorage.getItem('lastTomorrowNotificationDate');
                const tomorrowString = tomorrow.toDateString();
                
                if (lastTomorrowNotificationDate !== tomorrowString) {
                    showTomorrowEventsNotification(tomorrowEvents);
                    localStorage.setItem('lastTomorrowNotificationDate', tomorrowString);
                }
            }
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o s·ª± ki·ªán h√¥m nay
        function showTodayEventsNotification(events) {
            const eventNames = events.map(e => e.name).join(', ');
            const eventTypes = events.map(e => getEventTypeIcon(e.type)).join('');
            
            const notification = new Notification(`${eventTypes} H√¥m nay c√≥ s·ª± ki·ªán ƒë·∫∑c bi·ªát!`, {
                body: `üìÖ ${eventNames}`,
                icon: '/calendar/icons/icon-512.png',
                badge: '/calendar/icons/icon-512.png',
                tag: 'today-events',
                requireInteraction: true
            });

            navigator.serviceWorker.getRegistration().then(function(reg) {
              if (reg) {
                reg.showNotification(`${eventTypes} H√¥m nay c√≥ s·ª± ki·ªán ƒë·∫∑c bi·ªát!`, {
                  body: `üìÖ ${eventNames}`,
                  icon: '/calendar/icons/icon-512.png',
                  badge: '/calendar/icons/icon-512.png'
                });
              }
            });

            notification.onclick = function() {
                window.focus();
                notification.close();
            };
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o s·ª± ki·ªán ng√†y mai
        function showTomorrowEventsNotification(events) {
            const eventNames = events.map(e => e.name).join(', ');
            const eventTypes = events.map(e => getEventTypeIcon(e.type)).join('');
            
            const notification = new Notification(`${eventTypes} Ng√†y mai c√≥ s·ª± ki·ªán ƒë·∫∑c bi·ªát!`, {
                body: `üìÖ ${eventNames}`,
                icon: '/calendar/icons/icon-512.png',
                badge: '/calendar/icons/icon-512.png',
                tag: 'tomorrow-events'
            });

            navigator.serviceWorker.getRegistration().then(function(reg) {
              if (reg) {
                reg.showNotification(`${eventTypes} Ng√†y mai c√≥ s·ª± ki·ªán ƒë·∫∑c bi·ªát!`, {
                  body: `üìÖ ${eventNames}`,
                  icon: '/calendar/icons/icon-512.png',
                  badge: '/calendar/icons/icon-512.png'
                });
              }
            });

            notification.onclick = function() {
                window.focus();
                notification.close();
            };

            setTimeout(() => {
                notification.close();
            }, 10000);
        }

        // L·∫•y icon theo lo·∫°i s·ª± ki·ªán
        function getEventTypeIcon(type) {
            switch(type) {
                case 'birthday': return 'üéÇ';
                case 'memorial': return 'üïØÔ∏è';
                case 'holiday': return 'üéâ';
                case 'anniversary': return 'üíç';
                case 'date': return 'üíï';
                case 'work': return 'üíº';
                case 'health': return 'üè•';
                case 'travel': return '‚úàÔ∏è';
                case 'study': return 'üìö';
                case 'sports': return '‚öΩ';
                case 'family': return 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶';
                case 'friends': return 'üë•';
                default: return 'üìÖ';
            }
        }

        // Load d·ªØ li·ªáu t·ª´ localStorage
        function loadSpecialDates() {
            const savedEvents = localStorage.getItem('specialEvents');
            if (savedEvents) {
                const parsed = JSON.parse(savedEvents);
                // ƒê·∫£m b·∫£o c·∫•u tr√∫c d·ªØ li·ªáu ƒë√∫ng v·ªõi c√°c lo·∫°i m·ªõi
                if (parsed.oneTime && parsed.yearly) {
                    specialEvents = parsed;
                } else {
                    // Migrate d·ªØ li·ªáu c≈© n·∫øu c√≥
                    if (parsed.birthdays) {
                        specialEvents.yearly.birthdays = parsed.birthdays || [];
                        specialEvents.yearly.memorials = parsed.memorials || [];
                        specialEvents.yearly.holidays = parsed.holidays || [];
                        specialEvents.yearly.others = parsed.others || [];
                    }
                }
            }
            updateSpecialDatesList();
        }

        // L∆∞u d·ªØ li·ªáu v√†o localStorage
        function saveSpecialDates() {
            localStorage.setItem('specialEvents', JSON.stringify(specialEvents));
        }

        // Toggle hi·ªÉn th·ªã ph·∫ßn qu·∫£n l√Ω ng√†y ƒë·∫∑c bi·ªát
        function toggleSpecialDatesSection() {
            const container = document.getElementById('specialDatesContainer');
            container.classList.toggle('hidden');
        }

        // Th√™m ng√†y ƒë·∫∑c bi·ªát
        function addSpecialDate() {
            const day = parseInt(document.getElementById('specialDay').value);
            const month = parseInt(document.getElementById('specialMonth').value);
            const year = currentRepeatType === 'oneTime' ? parseInt(document.getElementById('specialYear').value) : null;
            const eventType = document.getElementById('eventType').value;
            const note = document.getElementById('specialNote').value.trim();

            if (!day || !month) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y v√† th√°ng!');
                return;
            }

            if (currentRepeatType === 'oneTime' && !year) {
                alert('Vui l√≤ng nh·∫≠p nƒÉm cho s·ª± ki·ªán m·ªôt l·∫ßn!');
                return;
            }

            if (day < 1 || day > 31 || month < 1 || month > 12) {
                alert('Ng√†y th√°ng kh√¥ng h·ª£p l·ªá!');
                return;
            }

            if (currentRepeatType === 'oneTime' && (year < 1900 || year > 2100)) {
                alert('NƒÉm kh√¥ng h·ª£p l·ªá!');
                return;
            }

            if (!note) {
                alert('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi ho·∫∑c ghi ch√∫!');
                return;
            }

            const eventInfo = {
                day: day,
                month: month,
                name: note,
                id: Date.now().toString(),
                isLunar: eventType === 'memorial'
            };

            if (currentRepeatType === 'oneTime') {
                eventInfo.year = year;
            }

            // Ki·ªÉm tra tr√πng l·∫∑p
            const categoryName = eventType + 's';
            const targetEvents = specialEvents[currentRepeatType][categoryName] || [];
            const isDuplicate = targetEvents.some(event => {
                if (currentRepeatType === 'oneTime') {
                    return event.day === day && event.month === month && event.year === year && event.name === note;
                } else {
                    return event.day === day && event.month === month && event.name === note;
                }
            });

            if (isDuplicate) {
                alert('Ng√†y n√†y ƒë√£ t·ªìn t·∫°i trong danh s√°ch!');
                return;
            }

            // Th√™m v√†o m·∫£ng t∆∞∆°ng ·ª©ng
            if (!specialEvents[currentRepeatType][categoryName]) {
                specialEvents[currentRepeatType][categoryName] = [];
            }
            specialEvents[currentRepeatType][categoryName].push(eventInfo);

            saveSpecialDates();
            updateSpecialDatesList();
            createCalendar();

            // Clear form
            document.getElementById('specialDay').value = '';
            document.getElementById('specialMonth').value = '';
            document.getElementById('specialYear').value = '';
            document.getElementById('specialNote').value = '';

            alert('ƒê√£ th√™m ng√†y ƒë·∫∑c bi·ªát th√†nh c√¥ng!');
        }

        // X√≥a ng√†y ƒë·∫∑c bi·ªát
        function removeSpecialDate(id, type, repeatType) {
            const categoryName = type + 's';
            if (specialEvents[repeatType][categoryName]) {
                specialEvents[repeatType][categoryName] = specialEvents[repeatType][categoryName].filter(e => e.id !== id);
            }

            saveSpecialDates();
            updateSpecialDatesList();
            createCalendar();
        }

        // C·∫≠p nh·∫≠t danh s√°ch ng√†y ÔøΩÔøΩ·∫∑c bi·ªát
        function updateSpecialDatesList() {
            const listContainer = document.getElementById('specialDatesList');
            listContainer.innerHTML = '';

            const allEvents = [];

            // Th√™m s·ª± ki·ªán m·ªôt l·∫ßn
            const eventTypes = ['birthdays', 'memorials', 'holidays', 'anniversaries', 'dates', 'works', 'healths', 'travels', 'studies', 'sports', 'families', 'friends', 'others'];
            
            eventTypes.forEach(category => {
                if (specialEvents.oneTime[category]) {
                    specialEvents.oneTime[category].forEach(e => {
                        allEvents.push({
                            ...e,
                            type: category.slice(0, -1), // Remove 's'
                            repeatType: 'oneTime',
                            typeName: getEventTypeName(category.slice(0, -1)),
                            calendar: e.isLunar ? '√Çm l·ªãch' : 'D∆∞∆°ng l·ªãch'
                        });
                    });
                }
            });

            // Th√™m s·ª± ki·ªán h√†ng nƒÉm
            eventTypes.forEach(category => {
                if (specialEvents.yearly[category]) {
                    specialEvents.yearly[category].forEach(e => {
                        allEvents.push({
                            ...e,
                            type: category.slice(0, -1), // Remove 's'
                            repeatType: 'yearly',
                            typeName: getEventTypeName(category.slice(0, -1)),
                            calendar: e.isLunar ? '√Çm l·ªãch' : 'D∆∞∆°ng l·ªãch'
                        });
                    });
                }
            });

            // S·∫Øp x·∫øp theo th√°ng v√† ng√†y
            allEvents.sort((a, b) => {
                if (a.month !== b.month) return a.month - b.month;
                if (a.day !== b.day) return a.day - b.day;
                if (a.year && b.year) return a.year - b.year;
                return 0;
            });

            allEvents.forEach(event => {
                const item = document.createElement('div');
                item.className = `special-date-item ${event.type}`;
                
                const dateStr = event.year ? `${event.day}/${event.month}/${event.year}` : `${event.day}/${event.month}`;
                const repeatStr = event.repeatType === 'oneTime' ? '(M·ªôt l·∫ßn)' : '(H√†ng nƒÉm)';
                
                item.innerHTML = `
                    <div>
                        <strong>${getEventTypeIcon(event.type)} ${dateStr}</strong> - <strong>${event.name}</strong>
                        <br>
                        <small>${event.typeName} (${event.calendar}) ${repeatStr}</small>
                    </div>
                    <button class="delete-btn" onclick="removeSpecialDate('${event.id}', '${event.type}', '${event.repeatType}')">üóëÔ∏è X√≥a</button>
                `;
                listContainer.appendChild(item);
            });

            if (allEvents.length === 0) {
                listContainer.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Ch∆∞a c√≥ ng√†y ƒë·∫∑c bi·ªát n√†o ƒë∆∞·ª£c l∆∞u.</p>';
            }
        }

        // L·∫•y t√™n lo·∫°i s·ª± ki·ªán
        function getEventTypeName(type) {
            switch(type) {
                case 'birthday': return 'üéÇ Sinh nh·∫≠t';
                case 'memorial': return 'üïØÔ∏è Ng√†y gi·ªó';
                case 'holiday': return 'üéâ Ng√†y l·ªÖ';
                case 'anniversary': return 'üíç K·ª∑ ni·ªám';
                case 'date': return 'üíï H·∫πn h√≤';
                case 'work': return 'üíº C√¥ng vi·ªác';
                case 'health': return 'üè• S·ª©c kh·ªèe';
                case 'travel': return '‚úàÔ∏è Du l·ªãch';
                case 'study': return 'üìö H·ªçc t·∫≠p';
                case 'sports': return '‚öΩ Th·ªÉ thao';
                case 'family': return 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Gia ƒë√¨nh';
                case 'friends': return 'üë• B·∫°n b√®';
                case 'other': return 'üìÖ Kh√°c';
                default: return 'üìÖ Kh√°c';
            }
        }

        // Ki·ªÉm tra ng√†y c√≥ s·ª± ki·ªán ƒë·∫∑c bi·ªát kh√¥ng
        function getSpecialEventsForDate(date, month, year) {
            const events = [];
            const eventTypes = ['birthdays', 'memorials', 'holidays', 'anniversaries', 'dates', 'works', 'healths', 'travels', 'studies', 'sports', 'families', 'friends', 'others'];
            
            // Ki·ªÉm tra s·ª± ki·ªán m·ªôt l·∫ßn
            eventTypes.forEach(category => {
                if (specialEvents.oneTime[category]) {
                    specialEvents.oneTime[category].forEach(event => {
                        let matches = false;
                        
                        if (event.isLunar) {
                            // Ki·ªÉm tra √¢m l·ªãch
                            const lunarDate = convertSolar2Lunar(date, month + 1, year, 7.0);
                            matches = event.day === lunarDate[0] && event.month === lunarDate[1] && event.year === year;
                        } else {
                            // Ki·ªÉm tra d∆∞∆°ng l·ªãch
                            matches = event.day === date && event.month === (month + 1) && event.year === year;
                        }
                        
                        if (matches) {
                            events.push({
                                ...event,
                                type: category.slice(0, -1)
                            });
                        }
                    });
                }
            });

            // Ki·ªÉm tra s·ª± ki·ªán h√†ng nƒÉm
            eventTypes.forEach(category => {
                if (specialEvents.yearly[category]) {
                    specialEvents.yearly[category].forEach(event => {
                        let matches = false;
                        
                        if (event.isLunar) {
                            // Ki·ªÉm tra √¢m l·ªãch
                            const lunarDate = convertSolar2Lunar(date, month + 1, year, 7.0);
                            matches = event.day === lunarDate[0] && event.month === lunarDate[1];
                        } else {
                            // Ki·ªÉm tra d∆∞∆°ng l·ªãch
                            matches = event.day === date && event.month === (month + 1);
                        }
                        
                        if (matches) {
                            events.push({
                                ...event,
                                type: category.slice(0, -1)
                            });
                        }
                    });
                }
            });

            return events;
        }

        // C√°c h√†m chuy·ªÉn ƒë·ªïi l·ªãch (gi·ªØ nguy√™n t·ª´ code c≈©)
        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
        }

        function jdFromDate(dd, mm, yy) {
            var a, y, m, jd;
            a = Math.floor((14 - mm) / 12);
            y = yy + 4800 - a;
            m = mm + 12 * a - 3;
            jd = dd + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - Math.floor(y / 100) + Math.floor(y / 400) - 32045;
            if (jd < 2299161) {
                jd = dd + Math.floor((153 * m + 2) / 5) + 365 * y + Math.floor(y / 4) - 32083;
            }
            return jd;
        }

        function NewMoon(k) {
            var T, T2, T3, dr, Jd1, M, Mpr, F, C1, deltat, JdNew;
            T = k / 1236.85;
            T2 = T * T;
            T3 = T2 * T;
            dr = Math.PI / 180;
            Jd1 = 2415020.75933 + 29.53058868 * k + 0.0001178 * T2 - 0.000000155 * T3;
            Jd1 = Jd1 + 0.00033 * Math.sin((166.56 + 132.87 * T - 0.009173 * T2) * dr);
            M = 359.2242 + 29.10535608 * k - 0.0000333 * T2 - 0.00000347 * T3;
            Mpr = 306.0253 + 385.81691806 * k + 0.0107306 * T2 + 0.00001236 * T3;
            F = 21.2964 + 390.67050646 * k - 0.0016528 * T2 - 0.00000239 * T3;
            C1 = (0.1734 - 0.000393 * T) * Math.sin(M * dr) + 0.0021 * Math.sin(2 * dr * M);
            C1 = C1 - 0.4068 * Math.sin(Mpr * dr) + 0.0161 * Math.sin(dr * 2 * Mpr);
            C1 = C1 - 0.0004 * Math.sin(dr * 3 * Mpr);
            C1 = C1 + 0.0104 * Math.sin(dr * 2 * F) - 0.0051 * Math.sin(dr * (M + Mpr));
            C1 = C1 - 0.0074 * Math.sin(dr * (M - Mpr)) + 0.0004 * Math.sin(dr * (2 * F + M));
            C1 = C1 - 0.0004 * Math.sin(dr * (2 * F - M)) - 0.0006 * Math.sin(dr * (2 * F + Mpr));
            C1 = C1 + 0.0010 * Math.sin(dr * (2 * F - Mpr)) + 0.0005 * Math.sin(dr * (2 * Mpr + M));
            if (T < -11) {
                deltat = 0.001 + 0.000839 * T + 0.0002261 * T2 - 0.00000845 * T3 - 0.000000081 * T * T3;
            } else {
                deltat = -0.000278 + 0.000265 * T + 0.000262 * T2;
            }
            JdNew = Jd1 + C1 - deltat;
            return JdNew;
        }

        function SunLongitude(jdn) {
            var T, T2, dr, M, L0, DL, L;
            T = (jdn - 2451545.0) / 36525;
            T2 = T * T;
            dr = Math.PI / 180;
            M = 357.52910 + 35999.05030 * T - 0.0001559 * T2 - 0.00000048 * T * T2;
            L0 = 280.46645 + 36000.76983 * T + 0.0003032 * T2;
            DL = (1.914600 - 0.004817 * T - 0.000014 * T2) * Math.sin(dr * M);
            DL = DL + (0.019993 - 0.000101 * T) * Math.sin(dr * 2 * M) + 0.000290 * Math.sin(dr * 3 * M);
            L = L0 + DL;
            L = L * dr;
            L = L - Math.PI * 2 * (Math.floor(L / (Math.PI * 2)));
            return L;
        }

        function getSunLongitude(dayNumber, timeZone) {
            return Math.floor(SunLongitude(dayNumber - 0.5 - timeZone / 24) / Math.PI * 6);
        }

        function getNewMoonDay(k, timeZone) {
            return Math.floor(NewMoon(k) + 0.5 + timeZone / 24);
        }

        function getLunarMonth11(yy, timeZone) {
            var k, off, nm, sunLong;
            off = jdFromDate(31, 12, yy) - 2415021;
            k = Math.floor(off / 29.530588853);
            nm = getNewMoonDay(k, timeZone);
            sunLong = getSunLongitude(nm, timeZone);
            if (sunLong >= 9) {
                nm = getNewMoonDay(k - 1, timeZone);
            }
            return nm;
        }

        function getLeapMonthOffset(a11, timeZone) {
            var k, last, arc, i;
            k = Math.floor((a11 - 2415021.076998695) / 29.530588853 + 0.5);
            last = 0;
            i = 1;
            arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
            do {
                last = arc;
                i++;
                arc = getSunLongitude(getNewMoonDay(k + i, timeZone), timeZone);
            } while (arc != last && i < 14);
            return i - 1;
        }

        function convertSolar2Lunar(dd, mm, yy, timeZone) {
            var k, dayNumber, monthStart, a11, b11, lunarDay, lunarMonth, lunarYear, lunarLeap;
            dayNumber = jdFromDate(dd, mm, yy);
            k = Math.floor((dayNumber - 2415021.076998695) / 29.530588853);
            monthStart = getNewMoonDay(k + 1, timeZone);
            if (monthStart > dayNumber) {
                monthStart = getNewMoonDay(k, timeZone);
            }
            a11 = getLunarMonth11(yy, timeZone);
            b11 = a11;
            if (a11 >= monthStart) {
                lunarYear = yy;
                a11 = getLunarMonth11(yy - 1, timeZone);
            } else {
                lunarYear = yy + 1;
                b11 = getLunarMonth11(yy + 1, timeZone);
            }
            lunarDay = dayNumber - monthStart + 1;
            diff = Math.floor((monthStart - a11) / 29);
            lunarLeap = 0;
            lunarMonth = diff + 11;
            if (b11 - a11 > 365) {
                leapMonthDiff = getLeapMonthOffset(a11, timeZone);
                if (diff >= leapMonthDiff) {
                    lunarMonth = diff + 10;
                    if (diff == leapMonthDiff) {
                        lunarLeap = 1;
                    }
                }
            }
            if (lunarMonth > 12) {
                lunarMonth = lunarMonth - 12;
            }
            if (lunarMonth >= 11 && diff < 4) {
                lunarYear -= 1;
            }
            return new Array(lunarDay, lunarMonth, lunarYear, lunarLeap);
        }

        function convertLunar2Solar(lunarDay, lunarMonth, lunarYear, lunarLeap, timeZone) {
            var k, a11, b11, off, leapOff, leapMonth, monthStart;
            if (lunarMonth < 11) {
                a11 = getLunarMonth11(lunarYear - 1, timeZone);
                b11 = getLunarMonth11(lunarYear, timeZone);
            } else {
                a11 = getLunarMonth11(lunarYear, timeZone);
                b11 = getLunarMonth11(lunarYear + 1, timeZone);
            }
            k = Math.floor(0.5 + (a11 - 2415021.076998695) / 29.530588853);
            off = lunarMonth - 11;
            if (off < 0) {
                off += 12;
            }
            if (b11 - a11 > 365) {
                leapOff = getLeapMonthOffset(a11, timeZone);
                leapMonth = leapOff - 2;
                if (leapMonth < 0) {
                    leapMonth += 12;
                }
                if (lunarLeap != 0 && lunarMonth != leapMonth) {
                    return new Array(0, 0, 0);
                } else if (lunarLeap != 0 || off >= leapOff) {
                    off += 1;
                }
            }
            monthStart = getNewMoonDay(k + off, timeZone);
            return jdToDate(monthStart + lunarDay - 1);
        }

        function jdToDate(jd) {
            var a, b, c, d, e, m, day, month, year;
            if (jd > 2299160) {
                a = jd + 32044;
                b = Math.floor((4 * a + 3) / 146097);
                c = a - Math.floor((b * 146097) / 4);
            } else {
                b = 0;
                c = jd + 32082;
            }
            d = Math.floor((4 * c + 3) / 1461);
            e = c - Math.floor((1461 * d) / 4);
            m = Math.floor((5 * e + 2) / 153);
            day = e - Math.floor((153 * m + 2) / 5) + 1;
            month = m + 3 - 12 * Math.floor(m / 10);
            year = b * 100 + d - 4800 + Math.floor(m / 10);
            return new Array(day, month, year);
        }

        function isFirstDayOfMonth(date, month, year, timeZone) {
            const lunarDate = convertSolar2Lunar(date, month + 1, year, timeZone);
            return lunarDate[0] === 1;
        }
        
        function isFullMoonDay(date, month, year, timeZone) {
            const lunarDate = convertSolar2Lunar(date, month + 1, year, timeZone);
            return lunarDate[0] === 15;
        }

        // H√†m t√¨m ki·∫øm ng√†y d∆∞∆°ng l·ªãch
        function searchSolarDate() {
            const day = parseInt(document.getElementById('solarDay').value);
            const month = parseInt(document.getElementById('solarMonth').value);
            const year = parseInt(document.getElementById('solarYear').value);

            if (!day || !month || !year) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y, th√°ng, nƒÉm d∆∞∆°ng l·ªãch!');
                return;
            }

            if (day < 1 || day > 31 || month < 1 || month > 12 || year < 1900 || year > 2100) {
                alert('Ng√†y th√°ng nƒÉm kh√¥ng h·ª£p l·ªá!');
                return;
            }

            const lunarDate = convertSolar2Lunar(day, month, year, 7.0);
            const resultDiv = document.getElementById('searchResults');
            const contentDiv = document.getElementById('resultContent');

            contentDiv.innerHTML = `
                <div class="result-item">
                    <strong>Ng√†y d∆∞∆°ng l·ªãch:</strong> ${day}/${month}/${year}<br>
                    <strong>Ng√†y √¢m l·ªãch:</strong> ${lunarDate[0]}/${lunarDate[1]}/${lunarDate[2]} ${lunarDate[3] ? '(Th√°ng nhu·∫≠n)' : ''}
                </div>
            `;

            resultDiv.classList.add('show');

            const today = new Date();
            monthOffset = (year - today.getFullYear()) * 12 + (month - 1 - today.getMonth());
            yearoffset = 0;
            createCalendar();
        }

        // H√†m t√¨m ki·∫øm ng√†y √¢m l·ªãch
        function searchLunarDate() {
            const lunarDay = parseInt(document.getElementById('lunarDay').value);
            const lunarMonth = parseInt(document.getElementById('lunarMonth').value);
            const lunarYear = parseInt(document.getElementById('lunarYear').value);

            if (!lunarDay || !lunarMonth || !lunarYear) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß ng√†y, th√°ng, nƒÉm √¢m l·ªãch!');
                return;
            }

            if (lunarDay < 1 || lunarDay > 30 || lunarMonth < 1 || lunarMonth > 12 || lunarYear < 1900 || lunarYear > 2100) {
                alert('Ng√†y th√°ng nƒÉm √¢m l·ªãch kh√¥ng h·ª£p l·ªá!');
                return;
            }

            const solarDate = convertLunar2Solar(lunarDay, lunarMonth, lunarYear, 0, 7.0);
            
            if (solarDate[0] === 0) {
                alert('Kh√¥ng th·ªÉ chuy·ªÉn ƒë·ªïi ng√†y √¢m l·ªãch n√†y!');
                return;
            }

            const resultDiv = document.getElementById('searchResults');
            const contentDiv = document.getElementById('resultContent');

            contentDiv.innerHTML = `
                <div class="result-item">
                    <strong>Ng√†y √¢m l·ªãch:</strong> ${lunarDay}/${lunarMonth}/${lunarYear}<br>
                    <strong>Ng√†y d∆∞∆°ng l·ªãch:</strong> ${solarDate[0]}/${solarDate[1]}/${solarDate[2]}
                </div>
            `;

            resultDiv.classList.add('show');

            const today = new Date();
            monthOffset = (solarDate[2] - today.getFullYear()) * 12 + (solarDate[1] - 1 - today.getMonth());
            yearoffset = 0;
            createCalendar();
        }

        // H√†m t·∫°o b·∫£ng l·ªãch
        function createCalendar() {
            const calendarContainer = document.getElementById("calendar");
            const today = new Date();
            let year = today.getFullYear() + Math.floor((monthOffset+today.getMonth()) / 12) + yearoffset;
            let month = (today.getMonth() + monthOffset) % 12;
            if (month < 0) {
                month += 12;
            } else if (month > 11) {
                month -= 12;
            }

            const months = [
                "Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6",
                "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"
            ];

            const daysInMonth = [
                31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30,
                31, 31, 30, 31, 30, 31
            ];

            const firstDayOfMonth = new Date(year, month, 1);
            let startingDay = firstDayOfMonth.getDay();
            startingDay = (startingDay === 0) ? 6 : startingDay - 1;

            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");

            const headerRow = document.createElement("tr");
            const monthHeader = document.createElement("th");
            monthHeader.colSpan = 7;
            monthHeader.textContent = months[month] + " " + year;
            headerRow.appendChild(monthHeader);
            thead.appendChild(headerRow);

            const daysHeaderRow = document.createElement("tr");
            const days = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "Ch·ªß Nh·∫≠t"];
            for (const day of days) {
                const dayHeader = document.createElement("th");
                dayHeader.textContent = day;
                daysHeaderRow.appendChild(dayHeader);
            }
            thead.appendChild(daysHeaderRow);

            let date = 1;
            for (let i = 0; i < 6; i++) {
                const row = document.createElement("tr");
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < startingDay) {
                        const emptyCell = document.createElement("td");
                        row.appendChild(emptyCell);
                    } else if (date > daysInMonth[month]) {
                        break;
                    } else {
                        const lunarDate = convertSolar2Lunar(date, month + 1, year, 7.0);
                        const cell = document.createElement("td");
                        cell.textContent = date;

                        if (year === today.getFullYear() && month === today.getMonth() && date === today.getDate()) {
                            cell.classList.add("today");
                        }

                        const lunarCell = document.createElement("div");
                        lunarCell.classList.add("lunar-date");
                        lunarCell.textContent = lunarDate[0] + "/" + lunarDate[1];
                        cell.appendChild(lunarCell);

                        const isFirstDay = isFirstDayOfMonth(date, month, year, 7.0);
                        const isFullMoon = isFullMoonDay(date, month, year, 7.0);
                        
                        if (isFirstDay || isFullMoon) {
                            lunarCell.classList.add("highlighlunar");
                        }

                        const specialEvents = getSpecialEventsForDate(date, month, year);
                        if (specialEvents.length > 0) {
                            const primaryEvent = specialEvents[0];
                            cell.classList.add(primaryEvent.type);
                            
                            const eventNote = document.createElement("div");
                            eventNote.classList.add("event-note");
                            eventNote.textContent = primaryEvent.name;
                            cell.appendChild(eventNote);

                            if (specialEvents.length > 1) {
                                const indicator = document.createElement("div");
                                indicator.classList.add("special-event-indicator");
                                indicator.title = `+${specialEvents.length - 1} s·ª± ki·ªán kh√°c`;
                                cell.appendChild(indicator);
                            }
                        }

                        row.appendChild(cell);
                        date++;
                    }
                }
                tbody.appendChild(row);
            }

            table.appendChild(thead);
            table.appendChild(tbody);
            calendarContainer.innerHTML = '';
            calendarContainer.appendChild(table);

            currentMonth = month;
            currentYear = year;
        }

        function prevMonth() {
            monthOffset--;
            createCalendar();
        }

        function nextMonth() {
            monthOffset++;
            createCalendar();
        }

        function prevYear() {
            yearoffset--;
            createCalendar();
        }
        
        function nextYear() {
            yearoffset++;
            createCalendar();
        }

        function now() {
            yearoffset = 0;
            monthOffset = 0;
            createCalendar();
        }

        function displayYearCalendar() {
            const calendarContainer = document.getElementById("calendar");
            let year = currentYear;
            
            calendarContainer.innerHTML = '';
            
            const yearCalendarDiv = document.createElement("div");
            for (let month = 0; month < 12; month++) {
                const monthCell = document.createElement("div");
                monthCell.classList.add("month-cell");
                createMonthTable(year, month, monthCell);
                yearCalendarDiv.appendChild(monthCell);
            }
            
            calendarContainer.appendChild(yearCalendarDiv);
        }

        function createMonthTable(year, month, cell) {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            const months = [
                "Th√°ng 1", "Th√°ng 2", "Th√°ng 3", "Th√°ng 4", "Th√°ng 5", "Th√°ng 6",
                "Th√°ng 7", "Th√°ng 8", "Th√°ng 9", "Th√°ng 10", "Th√°ng 11", "Th√°ng 12"
            ];
            
            const daysInMonth = [
                31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30,
                31, 31, 30, 31, 30, 31
            ];
            
            const firstDayOfMonth = new Date(year, month, 1);
            let startingDay = firstDayOfMonth.getDay();
            startingDay = (startingDay === 0) ? 6 : startingDay - 1;
            
            const table = document.createElement("table");
            const thead = document.createElement("thead");
            const tbody = document.createElement("tbody");
            
            const headerRow = document.createElement("tr");
            const monthHeader = document.createElement("th");
            monthHeader.colSpan = 7;
            monthHeader.textContent = months[month] + " " + year;
            headerRow.appendChild(monthHeader);
            thead.appendChild(headerRow);
            
            const daysHeaderRow = document.createElement("tr");
            const days = ["T2", "T3", "T4", "T5", "T6", "T7", "CN"];
            for (const day of days) {
                const dayHeader = document.createElement("th");
                dayHeader.textContent = day;
                daysHeaderRow.appendChild(dayHeader);
            }
            thead.appendChild(daysHeaderRow);
            
            let date = 1;
            for (let i = 0; i < 6; i++) {
                const row = document.createElement("tr");
                for (let j = 0; j < 7; j++) {
                    if (i === 0 && j < startingDay) {
                        const emptyCell = document.createElement("td");
                        row.appendChild(emptyCell);
                    } else if (date > daysInMonth[month]) {
                        break;
                    } else {
                        const cell = document.createElement("td");
                        cell.textContent = date;

                        if (year === currentYear && month === currentMonth && date === today.getDate()) {
                            cell.classList.add("today");
                        }
                        
                        const lunarDate = convertSolar2Lunar(date, month + 1, year, 7.0);
                        
                        const lunarCell = document.createElement("div");
                        lunarCell.classList.add("lunar-date");
                        lunarCell.textContent = lunarDate[0] + "/" + lunarDate[1];
                        cell.appendChild(lunarCell);

                        const isFirstDay = isFirstDayOfMonth(date, month, year, 7.0);
                        const isFullMoon = isFullMoonDay(date, month, year, 7.0);
                        
                        if (isFirstDay || isFullMoon) {
                            lunarCell.classList.add("highlighlunar");
                        }

                        const specialEvents = getSpecialEventsForDate(date, month, year);
                        if (specialEvents.length > 0) {
                            const primaryEvent = specialEvents[0];
                            cell.classList.add(primaryEvent.type);
                        }

                        row.appendChild(cell);
                        date++;
                    }
                }
                tbody.appendChild(row);
            }
            
            table.appendChild(thead);
            table.appendChild(tbody);
            
            cell.appendChild(table);
        }
    </script>
</body>
</html>
